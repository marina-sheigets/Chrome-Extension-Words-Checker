(()=>{"use strict";var t={SPACE:"Space",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight"},e={cat:["Dog","Rat","bat"],Helo:["hello","Help","Hell"],heldp:["help","held","hello"],foo:["bar"]},n=["keydown","click"],o="Input",r="Contenteditable",i=function(e,n,o){if(o===t.SPACE){var r=(n=n.slice(0,e)).split(" ").filter((function(t){return t}));return r[r.length-1].trim()}for(var i=n.trim().split(/\s+/),c=0,a=0;a<i.length;a++){var u=i[a],l=c,p=l+u.length;if(e>=l&&e<=p)return u;if(c+=u.length+1,a===i.length-1&&e===c)return i[a].trim()}return""},c=function(t){var e=t.split(/\s+/);return 1===e.length?t:e.join(" ")},a=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function c(t){try{u(o.next(t))}catch(t){i(t)}}function a(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}u((o=o.apply(t,e||[])).next())}))},u=function(t,e){var n,o,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,o=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){c.label=a[1];break}if(6===a[0]&&c.label<r[1]){c.label=r[1],r=a;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(a);break}r[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};const l=new(function(){function t(){this.popupDiv=null}return t.prototype.createPopup=function(t,e,n,r){var i=this,a=document.createElement("div");document.addEventListener("click",(function(t){i.isClickInsidePopup(t,a)||i.removePopup()})),a.id="popup",this.createPopupStyles(e);var u=document.createElement("ul");u.id="popup__list",t.forEach((function(t){var a=document.createElement("li");a.textContent=t,a.classList.add("popup__list-item"),u.appendChild(a);var l=p.countCursorPositions(e,r),s=l[0],d=l[1];a.addEventListener("click",(function(t){var a=function(t,e,n,o){if(" "===t[o-1]&&(" "===t[o]||o===t.length)){var r=t.slice(0,o),i=t.slice(o),a=c(r).replace(e,n);return c(a)+i}for(var u=t.split(/\s+/),l=0,p=0;p<u.length;p++){var s=l,d=s+u[p].length;if(o>=s&&o<=d)return t.slice(0,s)+n+t.slice(d);l=d+1}return o===t.length?t.replace(new RegExp("\\b".concat(u[u.length-1],"\\b")),n):t}(r===o?e.value:e.textContent,n,t.target.textContent,s);r===o?e.value=a:e.textContent=a,i.removePopup(),setTimeout((function(){r===o?e.setSelectionRange(d,d):function(t,e){var n=document.createRange(),o=window.getSelection();if(o&&t){for(var r=0,i=!1,c=0;c<t.childNodes.length;c++){var a=t.childNodes[c];if(a.nodeType===Node.TEXT_NODE){var u=a;if((r+=u.length)>=e){n.setStart(u,e-(r-u.length)),n.collapse(!0),i=!0;break}}}i||(n.setStart(t,0),n.collapse(!0)),o.removeAllRanges(),o.addRange(n)}}(e,d),e.focus()}),0)}))})),this.popupDiv=a,a.appendChild(u),this.createChangeBackgroundInput(a),document.body.appendChild(a)},t.prototype.createChangeBackgroundInput=function(t){return a(this,void 0,void 0,(function(){var e,n,o,r,i=this;return u(this,(function(c){switch(c.label){case 0:return(e=document.createElement("div")).id="color-input-wrapper",(n=document.createElement("label")).textContent="Color: ",n.htmlFor="color",n.style.fontStyle="italic",o=document.createElement("input"),r=o,[4,this.getStoredBackground()];case 1:return r.value=c.sent(),o.name="color",o.type="color",o.addEventListener("input",(function(e){var n=e.target;i.setStoredBackground(n.value),t.style.background=n.value})),e.appendChild(n),e.appendChild(o),t.appendChild(e),[2]}}))}))},t.prototype.removePopup=function(){this.popupDiv&&(document.body.removeChild(this.popupDiv),this.popupDiv=null)},t.prototype.isClickInsidePopup=function(t,e){return!this.popupDiv||this.popupDiv.contains(t.target)},t.prototype.getStoredBackground=function(){return new Promise((function(t){chrome.storage.local.get("dropdown-background",(function(e){var n=e["dropdown-background"];t(n)}))}))},t.prototype.setStoredBackground=function(t){chrome.storage.local.set({"dropdown-background":t})},t.prototype.createPopupStyles=function(t){return a(this,void 0,void 0,(function(){var e,n,o;return u(this,(function(r){switch(r.label){case 0:return e=document.createElement("style"),[4,this.getStoredBackground()];case 1:return n=r.sent(),o=t.getBoundingClientRect(),n||(n="white",this.setStoredBackground(n)),e.textContent="\n        #popup {\n            position: absolute;\n            left: ".concat(o.left,"px;\n            top: ").concat(o.top+o.height,"px;\n            background: ").concat(n,";\n            border: 1px solid #ccc;    \n\t\t\tborder-radius:4px;        \n            width:").concat(o.width,"px;\n\t\t\tz-index:5000;\n        }\n\n        #popup__list {\n            list-style:none;\n            padding:0;\n            margin: 0;\n        }\n\n        .popup__list-item {\n            cursor: pointer;\n            padding: 7px 15px;\n        }\n\n        \n        .popup__list-item:hover {\n            background: rgba(0,0,0,0.2);\n        }\n\n\t\t#color-input-wrapper{\n\t\t\tdisplay:flex;\n\t\t\tjustify-content:space-between;\n\t\t\tpadding: 5px;\n\t\t}\n        "),document.head.appendChild(e),[2]}}))}))},t}()),p=new(function(){function c(){}return c.prototype.handleTextInputElements=function(){var t=this,e=document.querySelectorAll('body input[type="text"], body textarea'),i=document.querySelectorAll('[contenteditable="true"]');e.forEach((function(e){var r=e.closest("iframe");r?t.handleClosestFrames(e,r):t.addMultipleEventListeners(e,n,o)})),i.forEach((function(e){var o=e.closest("iframe");o?t.handleClosestFrames(e,o):t.addMultipleEventListeners(e,n,r)}))},c.prototype.addMultipleEventListeners=function(t,e,o){var r=this;setTimeout((function(){e.forEach((function(e){t.addEventListener(e,(function(i){window.requestAnimationFrame((function(){var c=r.countCursorPositions(t,o),a=c[0],u=c[1];e===n[1]?r.handleClickEvent(a,u,i,t,o):r.handleKeydownEvent(a,i,t,o)}))}))}))}),100)},c.prototype.handleClickEvent=function(t,e,n,r,c){l.removePopup();var a,u=c===o?r.value:r.textContent;a=t!==e?u.slice(t,e).trim():i(t,u,n.code),this.checkWord(a,r,c)},c.prototype.handleKeydownEvent=function(e,n,r,c){l.removePopup();var a=c===o?r.value:r.textContent,u="";Object.values(t).includes(n.code)&&(u=i(e,a,n.code)),this.checkWord(u,r,c)},c.prototype.checkWord=function(t,n,o){e[t]&&l.createPopup(e[t],n,t,o)},c.prototype.countCursorPositions=function(t,e){var n,r;if(e===o)n=t.selectionStart,r=t.selectionEnd;else{var i=window.getSelection();if(i&&i.rangeCount>0){var c=i.getRangeAt(0);n=c.startOffset,r=c.endOffset}}return[n,r]},c.prototype.handleClosestFrames=function(t,e){var i,c=e.contentDocument||(null===(i=e.contentWindow)||void 0===i?void 0:i.document);if(c)if("true"===t.getAttribute("contenteditable")){var a=c.querySelector('[contenteditable="true"]');a&&this.addMultipleEventListeners(a,n,r)}else{var u=c.querySelector('input[type="text"]');u&&this.addMultipleEventListeners(u,n,o)}},c}());p.handleTextInputElements()})();